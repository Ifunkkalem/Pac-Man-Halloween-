<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Somnia Christmas Carnival</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.0/ethers.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #000;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        #header {
            width: 100%;
            background: #b91c1c; /* Merah Natal */
            padding: 10px 12px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        .header-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        #connectWalletBtn { background-color: #1e40af; color: white; } /* Biru */
        #playBtn { background-color: #16a34a; color: white; } /* Hijau */
        #leaderboardBtn { background-color: #d97706; color: white; } /* Orange */
        
        #gameContainer {
            width: 100%;
            max-width: 800px;
            margin: 12px auto;
            background: #27272a; /* Abu-abu gelap */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }
        #infoBar {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            font-size: 16px;
            font-weight: bold;
            color: #facc15; /* Kuning Emas */
        }
        #gameFrame, #logoPlaceholder, #leaderFrame {
            width: 100%;
            border: none;
            height: 600px; /* Tinggi yang cukup untuk Pacman game */
            display: none; /* Semua disembunyikan saat startup */
            background: #000;
        }
        #logoPlaceholder {
            display: block; /* Logo ditampilkan saat startup */
            background: url(assets/somnia_xmas_logo.png) no-repeat center center; /* Ganti dengan path gambar Anda */
            background-size: contain;
            background-color: #000;
            text-align: center;
            font-size: 24px;
            padding-top: 250px;
            color: white;
            font-weight: bold;
        }
        #jackpotDisplay {
             background: #1e40af;
             padding: 4px 8px;
             border-radius: 4px;
        }
        #topScoreDisplay {
             background: #d97706;
             padding: 4px 8px;
             border-radius: 4px;
        }
        #walletDisplay {
             color: #16a34a;
        }
    </style>
</head>
<body>

    <div id="header">
        <button id="connectWalletBtn" class="header-btn">Connect Wallet</button>
        <span id="walletDisplay">Wallet: Disconnected</span>
        <button id="playBtn" class="header-btn" style="display:none;">Play Game</button>
        <button id="leaderboardBtn" class="header-btn">Leaderboard</button>
    </div>

    <div id="gameContainer">
        <h2>SOMNIA CHRISTMAS CARNIVAL üéÑ</h2>
        
        <div id="infoBar">
            <span id="jackpotDisplay">Jackpot: <span id="jackpotValue">0.000000</span> SOMI</span>
            <span id="topScoreDisplay">üèÜ Top Score: <span id="topScoreValue">0</span></span>
        </div>

        <iframe id="gameFrame" src="pacman_xmas.html" allow="autoplay; fullscreen"></iframe>

        <iframe id="leaderFrame" src="leaderboard.html" style="display:none;"></iframe>
        
        <div id="logoPlaceholder">
            SOMNIA CHRISTMAS!<br>
            Main & menangkan Jackpot Natal üéÅ<br>
            <button id="startLogoBtn" class="header-btn" style="background:#16a34a; margin-top:20px;">Mulai</button>
        </div>
    </div>

    <script src="app.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
             // Handle tombol 'Mulai' di logoPlaceholder
             const startLogoBtn = document.getElementById("startLogoBtn");
             if (startLogoBtn) {
                 startLogoBtn.addEventListener("click", () => {
                     // Pemicu flow Pay to Play (akan memanggil requestStartGame di app.js)
                     document.getElementById("playBtn").click();
                 });
             }
        });

        window.addEventListener("message", (event) => {
            const data = event.data || {};
            
            // Handle update info wallet dari app.js
            if (data.type === "walletInfo") {
                document.getElementById("walletDisplay").textContent = "Wallet: " + data.address.substring(0, 6) + "..." + data.address.slice(-4);
                document.getElementById("connectWalletBtn").style.display = "none";
                document.getElementById("playBtn").style.display = "inline-block";
                document.getElementById("logoPlaceholder").style.display = "block";
                document.getElementById("gameFrame").style.display = "none";
                document.getElementById("leaderFrame").style.display = "none";
            }
            
            // Handle update data Jackpot/Top Score dari app.js
            if (data.type === "updateSummary") {
                document.getElementById("jackpotValue").textContent = data.jackpot;
                document.getElementById("topScoreValue").textContent = data.topScore;
            }

            // Handle start game dari app.js
            if (data.type === "paySuccess") {
                document.getElementById("logoPlaceholder").style.display = "none";
                document.getElementById("leaderFrame").style.display = "none";
                document.getElementById("gameFrame").style.display = "block";
            }
            
            // Handle tampilkan logo (Kembali ke Menu Utama)
            if (data.type === "forceShowLogo") {
                document.getElementById("gameFrame").style.display = "none";
                document.getElementById("leaderFrame").style.display = "none";
                document.getElementById("logoPlaceholder").style.display = "block";
            }
            
            // Handle navigasi Leaderboard
            if (data.type === "showLeaderboard") {
                document.getElementById("gameFrame").style.display = "none";
                document.getElementById("logoPlaceholder").style.display = "none";
                const lf = document.getElementById("leaderFrame");
                lf.src = "leaderboard.html?ts=" + Date.now();
                lf.style.display = "block";
            }
        });
        
    </script>
</body>
</html>

